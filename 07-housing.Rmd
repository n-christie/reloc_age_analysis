# Exploring data - Housing

Study period 2012-2020 when data is made available from SCB from the Real estate and Apartment registers.  Data is taken from three SCB data sources: lev_lisa, lev_housing, and lev_population.  The following steps are taken to arrive at a complete data set:

* The unique identifier __lopnr__ in the lev_population data set is filtered with the following criteria: index_p ==1 & ater_pnr == 0 & sen_pnr == 1.

* Next this set of unique identifiers are matched to the full lev_lisa data set, resulting in lisa data that contains only the unique identifiers from the first step.

* 690 duplicate lopnr-year observations are identified and removed from the data set.  Further inspection indicated this small number is a result of messy data, showing no trend or further information.

* As data from lev_lisa ends in 2019 and data from the lev_housing data set ends in 2020, time invariant variables(year of birth, sex, education, etc.) from unique individuals in 2019 are replicated for 2020 to facilitate the appropriate matching to the unique identifiers in the 2020 Housing data. 

* Lastly, the data is joined by the unique lopnr-year combination with the lev_housing data.

## Descriptive statistics
```{r,out.width="100%"}

knitr::include_graphics(here("output/figures", "no_individual.png"))
```

Here we see that the vast majority of individuals who have relocated in the sample period have done so only once(82%),
with a small proportion moving 3 times or more (about 3%)





```{r,out.width="100%"}

knitr::include_graphics(here("output/figures", "no_individual_red.png"))
```


On the relocation level, we see that about 70% of revocations have been between some combination of Multi-dwelling and One-dwelling housing types, with a lower proportion of revocations into Special housing



```{r,out.width="100%"}

knitr::include_graphics(here("output/figures", "age_group_housing.png"))
```


Here, at the housing level, we can see that those in Special housing are mostly in the 85+ category.

## Specific data considerations

### Translating types of housing and tenure

(From Susanne):

___Hustyper och upplåtelseformer___

svenska/engelska

Med bostadslägenhet avses en lägenhet avsedd att helt eller till en inte oväsentlig del användas som bostad, oavsett i vilken hustyp den ligger.
Även bostäder i småhus definieras således som lägenheter. 
Upplåtelseform Lägenheternas upplåtelseform utgår från ägarförhållandet och inte hur de boende förfogar över lägenheterna

___Hustyp/Type of housing___

*	__Småhus__ avser friliggande en- och tvåbostadshus samt par-, rad- och kedjehus (exklusive fritidshus).
*	__One-or-two-dwelling buildings__ means detached buildings as well as semi-detached, row and linked buildings (excluding buildings for seasonal and secondary use).
*	__Flerbostadshus__ avser bostadsbyggnader innehållande tre eller flera lägenheter inklusive loftgångshus.
*	__Multi-dwelling buildings__ means buildings with three or more apartments including balcony access housing.
*	__Övriga__ hus avser byggnader som inte huvudsakligen är avsedda för bostadsändamål men ändå innehåller bostadslägenheter, t.ex. byggnader avsedda för verksamhet/samhälls¬funktion.
*	__Other housing__ means buildings that are not mainly intended for residential purposes but still contains ordinary dwellings, e.g. buildings used for business/public function.
*	__Specialbostäder__ avser bostäder för äldre/funktionshindrade, studentbostäder, etc.
*	__Special housing__ means dwellings for older people, persons with disabilities, students, etc.

___Upplåtelseform___

*	__Hyresrätt__: Flerbostadshus och övriga hus med hyresrätt avser lägenheter som inte är ägarlägenheter och som ägs av andra än bostadsrättsföreningar/bostadsföreningar. Småhus med hyresrätt avser lägenheter som ägs av andra ägare än fysiska personer, dödsbon, bostadsrättsföreningar/bostadsföreningar.
*	__Rented dwellings__: Multi-dwelling and other buildings with dwellings that are owned by other than housing cooperatives. One- or two-dwelling buildings with rented dwellings means apartments owned by other than private persons, estates of deceased persons or housing cooperatives.
*	__Bostadsrätt__: Bostadsrätt avser lägenheter som ägs av bostadsrättsföreningar/ bostadsföreningar (äldre form som existerade innan 1930).
*	__Tenant-owned dwelling__: One-, two- or multi-dwellings owned by housing cooperatives.
*	__Äganderätt__: Småhus med äganderätt avser lägenheter som ägs av fysiska personer eller dödsbon. Flerbostadshus och övriga hus med äganderätt avser ägarlägenheter.
*	__Owner-occupied dwelling__: One- or two-dwelling buildings with apartments owned by private persons or estates of deceased persons. Multi-dwelling and other buildings with owner-occupied dwelling means condominiums.

Källa SCB, bearbetat av Susanne, 2022-09-08

Fotnot SCB:
Både nyproducerade och existerande lägenheter, vilka tidigare utgjort bortfall i registret, registreras löpande. Därutöver sker rättningar och kompletteringar av tidigare felaktiga uppgifter samt till följd av att det befintliga beståndet förändras, t.ex. genom ombyggnad och rivning. Största delen av de lägenheter som redovisas som specialbostäder och övriga hus från 2013 och framåt ingick tidigare i kategorin flerbostadshus.



### Identifying partners

There are some discrepancies in the data when finding consistent partner matches to unique individuals across the multiple data sets. 


We can find partner data in two of the datasets: __partners_rtb__ and __samh__. In the __partners_rtb__ dataset, we have three variables for every lopnr-year observation:

*	Lopnrsamh – (no definition given in the excel sheet) 1987-1997.
*	Lopnrsambo – “sambo’s personummer” from 1998.
*	Lopnrmakpart – “make/maka/partners personummer” ( I believe this is technically married) from 1998.

From the __samh__ dataset, we have one variable:
*	LopNrSamh – (no definition given in the accompanying excel sheet).

Since no particular partner variable was consistent over time, a new varaible is created, “partner”,  that takes the value of whichever variable has valid data (of one of the above variables) for that lopnr/year.  If there are two values, the priority is for the lopnrsamh from the __partners_rtb__ dataset (it seems to have the best coverage).  

A screenshot for an particular individual with multiple partners over time to illustrate.

```{r,out.width="80%"}

knitr::include_graphics(here("output/figures", "partners_png.png"))
```

### Recoding varaibles

Education, housing type, housing tenure



### Identifying relocations

To identify when an individual has relocated in the data the following considerations are taken into account.

* The housing variables, __fast_lopnr__ and __lghlopnr__ appear to uniquely identify the housing location of a particular individual.  Over time, a change in either variable should indicate that an individual as relocated (highlighted in orange below).  This change appears to be the best indicator of whether an individual has relocated or not. 


```{r,out.width="100%"}

knitr::include_graphics(here("output/figures", "relocation_id.png"))
```

* The coordinate variables, __xkoord__ and __ykoord__ appear to be occasionally inconsistent, giving different values for the same  __fast_lopnr__ and __lghlopnr__ identifier in some of the data.  This may be the result of data errors or possibly a GPS margin of error when measuring housing location (Highlighted yellow).

*	The variable __n_housing__ counts how many unique __fast_lopnr__’s are associated with each __lopnr__.  For example, individual RED, has resided in three locations, Individual BLUE has resided in two locations, and Individual 40  has resided in one location during the sample period.

*	The vairalbes __change_housing__  and __change_tenure__ take the before and after values of __housing__  and __tenure__ (respectively) and return the before and after categories when a change (relocation) has occurred.

*	__Byggtyp__ appears to follow the patterns of __fast_lopnr__ and __lghlopnr__, but contains some missing data.  The missing __Byggtyp__ value seems to be associated with the values “Övriga hus” and “Specialböstader” in __housing__. 

### Identifying change in kommun

In a similar fashion as identifying the change in a housing identifier over time for an individual, we can observe when an individual has relocated outside of a geographical area when the geographical indicator changes. 